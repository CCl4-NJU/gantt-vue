### 写在开头：一些问题的解决方案&使用说明

##### S1. 无法在一行中显示多个进度条

- 首先明确一点，我确实没有找到能够在一行显示多个进度条的方法，但是使用了另一种显示方案来达到示例中的包含效果（即某个资源项在不同时间段为不同产品生产所使用）
- 将资源项单独作为一个进度条，其进度开始时间为资源第一次被使用时的开始时间，结束时间为资源最后被使用时的结束时间，意思就是该资源从当天XX时开始使用，在YY时结束使用**（注：XX-YY之间资源可能有没被使用的时间段）**

##### S2. 资源甘特图中，尚未找到在资源名称右侧插入饼状图的方法

- 考虑饼状图的优点：直观。此外饼状图的颜色也代表了资源负载的程度，但本质上能够反映出来的依旧是数字（如红色：60%~80%），所以可以使用数字数据对该项进行代替

##### S3. 产品路线图中，没有采用S1中提到的解决方案，而是直接将使用同一资源的不同工艺流程分开表示

- 我个人比较过将使用同一资源的不同工艺分别合并到一个进度条下（S1的解决方案）和分开表示，发现由于线的存在，会导致如果使用S1方案，会使得页面非常混乱且扭曲

##### S4. 订单甘特图中，对于一个订单，总是采用父子进度条来显示订单的完成程度，父进度条表示整个订单的完成程度，子进度条表示订单中单一工艺的完成程度

- 例如订单762904，包含工艺装配和测试，父进度条显示完成20%，装配子进度条显示完成23%，测试子进度条显示完成18%

##### 使用说明

由于路由配置出了点问题，暂时没法通过链接来切换页面......

src文件夹下

- Page.vue对应订单甘特图的demo
- App.vue和BackupApp.vue对应产品路线图的demo
- Main.vue对应资源甘特图的demo

切换时，只需要把对应.vue文件下所有内容复制，然后覆盖App.vue中的内容，再把App.vue中export代码区块的name改成'app'即可



### 甘特图数据接口



#### 订单甘特图

##### 数据格式

- 对象id：id: int
- 订单号：number: String
- **任务名称：text: String**
- **开始时间：start_date: String**
- **持续时间：duration: int**
- **完成度：progress: float**
- **颜色：color: String**
- 产品名称：name: String
- 约定交期：deal_date: String
- 预计交期：expc_date: String
- **父任务id：parent: int**

##### 数据说明

- 任务名称
  - 如果是父任务，任务名称格式为：{工艺A}，{工艺B}，...，{工艺N}
    - 如"装配，测试"，"装配"等
  - 如果是子任务，任务名称格式为：{工艺A}+{完成度}
    - 如"装配23%"，"测试100%"等
- 开始时间：统一为当天日期的早上7点（保证进度条起始位置相同）
  - 如2020年10月1日时就是：2020-10-01 07:00
- 持续时间：统一为360（保证进度条长度一致）
- 完成度
  - 如果是父任务，则表示为整个订单的完成程度，具体如何定义可以由后端决定，可以简单定义为各个工艺完成度的加权平均和，也可以有更复杂精确的定义方式
  - 如果是子任务，则表示子任务所代表的工艺的完成程度
    - 如"装配23%"的子任务，完成度为0.23；"测试100%"的子任务，完成度为1.00
- 颜色
  - 如果任务延期，不论完成度为多少，都设置为red
  - 如果任务未延期
    - 完成度为1.00的，设置为lime
    - 完成度低于1.00的，设置为darkturquoise
- 产品名称：订单对应的产品名称
- 约定交期：yyyy年MM月dd日
  - 如"2020年09月01日"
- 预计交期：同上
- 父任务id
  - 如果是父任务，不需要该键值对
  - 如果是子任务，设置为其父任务的对象id

##### 数据示例

![1602646321652](E:\typora-img\1602646321652.png)

##### 界面展示

![1602646337578](E:\typora-img\1602646337578.png)

![1602646356637](E:\typora-img\1602646356637.png)



#### 资源甘特图

##### 数据格式

- 对象id：id: int
- 资源名称：resource: String
- 资源使用率：percent: String
- **开始时间：start_date: String**
- **持续时间：duration: int**
- 产品名称：text: String
- **产品颜色：color: String**
- **产品id：product_id: String/int**
- **占用资源：parent: int**

##### 数据说明

该部分数据分为资源项和产品项，资源项表示当天资源使用的信息，产品项表示某个产品使用某资源的信息，同时所有的资源项都是父级进度条，所有的产品项都是子级进度条

- 资源使用率：某项资源当天的使用率，格式为：{使用率}+%
  - 如75%，80%，100%等
  - 如果是产品项，则传""字符串即可
- 开始时间：格式为：yyyy-MM-dd
  - 如果是资源项，则表示该资源第一次被使用时的开始时间
    - 如人力资源张三组，在19:00-21:00，21:00-23:00都被占用，则开始时间就为{2020-10-01 19:00}
  - 如果是产品项，则表示该产品占用该资源的使用时间
    - 如产品3占用张三组人力资源的情况，开始时间就为{2020-10-01 19:00}
- 持续时间：以分钟为单位，表示任务持续时间
  - 如果是资源项，则等于该资源最后一次被使用的结束时间减去第一次被使用时的开始时间（即开始时间数据项）
    - 如张三人力资源，duration就为4 * 60 = {2020-10-01 23:00} - {2020-10-01 19:00}
  - 如果是产品项，则为该产品某项工艺占用相应资源的时间
    - 如产品3在19:00-21:00占用了张三组人力资源，所以duration就为2 * 60
- 产品名称：text（之所以命名为text，与dhtmlx-gantt的属性定义相关）
  - 如果是资源项，则传""字符串即可
  - 如果是产品项，则传对应产品的名称即可
- 产品颜色：可能需要后端来决定不同产品的颜色，同时还要判断延期订单问题
  - 如果是资源项，则统一设置为"darkturquoise"
  - 如果是产品项
    - 若相应的工艺任务为延期任务，则设置为red
    - 否则根据后端分配给不同产品的不同颜色设置
- 产品id：不管传的是String还是int，只要保证前端能够根据该id获取对应产品的路线图数据即可
- 占用资源
  - 如果是资源项，则不需要该项键值对
  - 如果是产品项，则设置为其占用资源所对应资源项的对象id
    - 如产品4在21:00-次日5:00占用了生产线1，生产线1的对象id为1，则产品4占用生产线1的产品项数据中，parent=1

##### 数据示例

![1602654518138](E:\typora-img\1602654518138.png)

![1602654564020](E:\typora-img\1602654564020.png)

![1602654599941](E:\typora-img\1602654599941.png)

##### 界面展示

![1602654649674](E:\typora-img\1602654649674.png)

![1602654670189](E:\typora-img\1602654670189.png)



#### 产品路线图

##### 数据格式：data和links

###### data

- 对象id：id: int
- 资源名称：resource: String
- 产品名称：text: String
- 开始时间：start_date: String
- 持续时间：duration: int

###### links

- 连接项id：id: int
- 头对象id：source: int
- 尾对象id：target: int
- 连接类型：type: String

##### 数据说明

data部分的数据含义基本和前面两个甘特图的一致

links部分表示的是工艺顺序

- 连接项id：表示当前连接数据的id，唯一即可
- 头对象&尾对象id：表示连接起始点和终止点所在的data项的对象id
  - 如产品3在Line1的某工艺（id=1）需要在Line4的某工艺（id=2）结束后进行，则：
  - 头对象id：source=2；尾对象id：target=1
- 连接类型：统一设置为"0"

##### 数据示例

![1602655266092](E:\typora-img\1602655266092.png)

![1602655281310](E:\typora-img\1602655281310.png)

##### 界面展示

![1602655300403](E:\typora-img\1602655300403.png)



### 写在最后：一些需要讨论的问题

##### 资源甘特图中，不同的产品需要不同的颜色来表示，同时延期订单需要标红

- 颜色由前端还是后端来维护？
  - 个人认为由后端传比较好，因为前端并不会知道当天要显示多少种产品，无法决定颜色数量

##### 订单甘特图中，不同订单号在订单进度那一栏，进度条的长度各不相同

- 长度需要统一还是和示例一样？
  - 个人认为统一会方便一些，但如果要做到长短不一也并非不行。我没看懂示例中长度是如何决定的，我想出来的长度定义是根据订单持续的时间来决定的（比如订单1从2020-10-01 7:00开始，直到2020-10-01-19:00结束所有流程，中间可能有些时间段没有进行订单1产品的生成，但订单1生产的持续时间为12小时，因此其长度就是duration: 12*60）。但是这样又会带来一个问题：如果一个订单持续了24小时甚至更多，页面没办法在一个浏览器宽度内显示完整个进度条，从而不够直观，所以我还是倾向于长度一致的做法（尽管demo中使用的是长度不一致的方法）

##### 产品路线图中，对于产品3，有资源（李四）并没有被用到，但仍然显示在界面上

- demo中则选择把李四相关的内容删除了，所以在这种情况下，如果在资源甘特图中点击产品3，就应该进行页面跳转重新渲染页面
- 在示例中点击产品3后，是对除产品3以外的部分做了透明度提升，但是由于线的存在，个人认为跳转重新渲染会好一点